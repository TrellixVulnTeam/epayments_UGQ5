<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='/img/favicon.ico') }}">
    <title>New ePayments</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="/static/fontawesome/css/all.min.css">

    <!-- NYC Theme CSS -->
    <link rel="stylesheet" href="/static/css/theme.css">

    <!-- datepicker -->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">

</head>
<body>

    <section>
        <div class="container justify-content-center text-center">
            <h1>ePayments</h1>
            <div class="mb-2">
                <a href="{{ url_for("main.newlogout") }}" class="btn btn-primary">Logout</a>
                <button id='applybtn' type="submit" class="btn btn-success" role="button">Apply</button>
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#change_pass_modal">
                    Password Change
                </button>

                <!-- Modal -->
                <div class="modal fade" id="change_pass_modal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header text-center justify-content-center">
                                <h5 class="modal-title" id="password_modal">Password Change</h5>
                            </div>
                            <div class="modal-body text-left">
                                <div>
                                    <label for="new_pass" class="font-weight-bold">New Password</label>
                                    <input type="password" class="form-control rounded-pill" id="new_pass"
                                           name="new_password"
                                           placeholder="New Password" required>
                                </div>
                                <div>
                                    <label for="confirm_pass" class="font-weight-bold">Confirm Password</label>
                                    <input type="password" class="form-control rounded-pill" id="confirm_pass"
                                           name="confirm_pass"
                                           placeholder="Re-enter New Password" required>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-danger rounded" data-dismiss="modal" id="modal_close">
                                    Close
                                </button>
                                <button type="button" class="btn btn-success rounded" id="pass_submit">Save</button>
                            </div>
                        </div>
                        <!-- modal -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="search">
        <div class="row">

            <div class="col-2">
                {% include "searchform.html" %}
            </div>
            <!-- search form div -->

            <div class="col-8">
                <div class="container-fluid">
                    <div id="orders" class="shadow p-1">
                        <div id="order_rows"></div>
                    </div>
                </div>
            </div>
            <!-- order rows div -->

            <div id="order_counts" class="col-2">
                <div class="container">
                    <div id="total_orders"></div>
                    <div id="total_suborders"></div>
                </div>
            </div>
            <!-- order counts -->

        </div>
    </section>


    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

    <!-- bootstrap javascript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>

    <!-- script for search form -->
    <script src="/static/js/search-form.js"></script>

    <!-- NYC template JS (RTL, search and language toggle, back to top)  -->
    <script src="/static/js/main.js"></script>
    <script src="/static/js/responsive-table.js"></script>

    <script>
        $('#pass_submit').click(function () {
            $.ajax({
                type: "PATCH",
                url: "api/v1/password",
                data: JSON.stringify({
                    'password': $('#new_pass').val(),
                    'confirm_password': $('#confirm_pass').val()
                }),
                datatype: "json",
                success: function (result) {
                    alert(result['message'])
                    $('#modal_close').click()
                },
                error: function (result) {
                    alert(result['responseJSON']['error']['message'])
                }
            });
        })
    </script>


</body>
</html>